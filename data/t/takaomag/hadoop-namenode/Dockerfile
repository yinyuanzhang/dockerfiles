# hadoop-namenode

FROM takaomag/hadoop:release-2.8.1-2017.08.07.07.13

ENV \
    X_DOCKER_REPO_NAME=hadoop-namenode

RUN \
    echo "2016-03-08-0" > /dev/null && \
    export TERM=dumb && \
    export LANG='en_US.UTF-8' && \
    source /opt/local/bin/x-set-shell-fonts-env.sh && \

    echo -e "${FONT_INFO}[INFO] Update package database${FONT_DEFAULT}" && \
    reflector --latest 100 --verbose --sort score --save /etc/pacman.d/mirrorlist && \
    sudo -u nobody yaourt -Syy && \
    echo -e "${FONT_SUCCESS}[SUCCESS] Update package database${FONT_DEFAULT}" && \

    echo -e "${FONT_INFO}[INFO] Refresh package developer keys${FONT_DEFAULT}" && \
    pacman-key --refresh-keys && \
    echo -e "${FONT_SUCCESS}[SUCCESS] Refresh package developer keys${FONT_DEFAULT}" && \

#    sed "s/__NAMENODE__/localhost/g" ${HADOOP_PREFIX}/etc/hadoop/core-site.xml.template > ${HADOOP_PREFIX}/etc/hadoop/core-site.xml && \
#    sed 's/__DFS_REPLICATION__/1/g' ${HADOOP_PREFIX}/etc/hadoop/hdfs-site.xml.template > ${HADOOP_PREFIX}/etc/hadoop/hdfs-site.xml && \
#    ${HADOOP_PREFIX}/bin/hdfs namenode -format && \
    cd /etc/supervisor.d && \
    ln -sf hadoop/hdfs-namenode.ini . && \
    ln -sf sshd/sshd.ini . && \

    /opt/local/bin/x-archlinux-remove-unnecessary-files.sh && \
#    pacman-optimize && \
    rm -f /etc/machine-id

EXPOSE \
    22 \
    8020 \
    50070 \
    50470

#ENTRYPOINT ["/usr/bin/supervisord", "--nodaemon", "--configuration=/etc/supervisord.conf"]
ENTRYPOINT ["/opt/local/bin/x-start_hdfs-namenode.sh"]

