FROM plitex/meteord:base
MAINTAINER Miguel Mejias

ONBUILD ARG NPM_PRIVATE_REGISTRY_URL
ONBUILD ARG NPM_PRIVATE_REGISTRY_SCOPE
ONBUILD ARG NPM_PRIVATE_REGISTRY_TOKEN
ONBUILD ENV NPM_PRIVATE_REGISTRY_URL $NPM_PRIVATE_REGISTRY_URL
ONBUILD ENV NPM_PRIVATE_REGISTRY_SCOPE $NPM_PRIVATE_REGISTRY_SCOPE
ONBUILD ENV NPM_PRIVATE_REGISTRY_TOKEN $NPM_PRIVATE_REGISTRY_TOKEN

ONBUILD COPY ./ /app
ONBUILD RUN bash $METEORD_DIR/lib/setup_npm_private_registry.sh
ONBUILD RUN bash $METEORD_DIR/lib/install_meteor.sh
ONBUILD RUN bash $METEORD_DIR/lib/install_node.sh
ONBUILD RUN bash $METEORD_DIR/lib/build_app.sh
ONBUILD RUN bash $METEORD_DIR/lib/cleanup_npm_config.sh

ONBUILD ENV NPM_PRIVATE_REGISTRY_TOKEN ""
