FROM node:10.15.3

ENV NODE_ENV production
ENV PROJECT_ROOT /usr/src/app/

WORKDIR $PROJECT_ROOT

ARG API_URL
ARG PUBLIC_URL
ARG CLOUDINARY_CLOUD_NAME
ARG CLOUDINARY_API_KEY
ARG CLOUDINARY_API_SECRET

ENV REACT_APP_API_URL               $API_URL
ENV REACT_APP_PUBLIC_URL            $PUBLIC_URL
ENV REACT_APP_CLOUDINARY_CLOUD_NAME $CLOUDINARY_CLOUD_NAME
ENV REACT_APP_CLOUDINARY_API_KEY    $CLOUDINARY_API_KEY
ENV REACT_APP_CLOUDINARY_API_SECRET $CLOUDINARY_API_SECRET

COPY package.json package.json
COPY package-lock.json package-lock.json

RUN npm install

COPY . .

RUN npm run build

CMD ["node", "server.js"]
