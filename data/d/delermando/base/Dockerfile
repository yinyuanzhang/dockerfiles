FROM ubuntu:12.04

# Install dependencies
RUN apt-get update -y
RUN apt-get install -y git curl apache2 php5 php5-cli php-pear php5-dev php5-gd php5-memcache php5-memcached php5-xsl php5-geoip php-soap php5-imap php5-curl php5-intl php5-mysql php5-xdebug php-apc libapache2-mod-php5 php5-mcrypt1
RUN apt-get install -y libxml2 autoconf file gcc libc-dev python-pip make pkg-config re2c --no-install-recommends && rm -r /var/lib/apt/lists/*
RUN pip install boto3

# Install composer
RUN curl -sS https://getcomposer.org/installer | php
RUN mv composer.phar /usr/bin/composer

# Install app
RUN rm -rf /var/www/html 
RUN mkdir -p /var/lock/apache2 /var/run/apache2 /var/log/apache2 /var/www/html 
RUN chown -R www-data:www-data /var/lock/apache2 /var/run/apache2 /var/log/apache2 /var/www/html

# Configure apache
RUN a2enmod rewrite
RUN a2enmod headers
RUN a2enmod expires
RUN chmod 755 /usr/sbin/apache2ctl
ENV APACHE_RUN_USER www-data
ENV APACHE_RUN_GROUP www-data
ENV APACHE_LOG_DIR /var/log/apache2

##<autogenerated>##
COPY apache2-foreground /usr/local/bin/
RUN chmod +x /usr/local/bin/apache2-foreground

EXPOSE 80
EXPOSE 443

WORKDIR /var/www/html
CMD ["/usr/local/bin/apache2-foreground"]
