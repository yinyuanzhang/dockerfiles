FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLXMzLWFwYgpkZXNjcmlwdGlvbjogUzMgYnVja2V0IGRl\
cGxveW1lbnQgaW4gT3BlbnNoaWZ0IGZvciBOdXhlbwpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0\
aW9uYWwKdGFnczoKICAtIG51eGVvCiAgLSBzMwptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogUzMg\
ZW52aXJvbm1lbnQgZm9yIE51eGVvCiAgaW1hZ2VVcmw6ICJodHRwczovL3d3dy5udXhlby5jb20v\
YXNzZXRzL2ltZ3MvbG9nbzM0MHg2MC5wbmciCiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgVGhpcyBE\
ZXBsb3lzIGFuIFMzIGVudmlyb25tZW50IHRoYXQgY2FuIGJlIHVzZWQgd2l0aCBOdXhlbwogIGRl\
cGVuZGVuY2llczogW10KICBwcm92aWRlckRpc3BsYXlOYW1lOiAiTnV4ZW8iCnBsYW5zOgogIC0g\
bmFtZTogbWluaW8KICAgIGRlc2NyaXB0aW9uOiBTMyBidWNrZXQgZGVwbG95ZWQgd2l0aCBNaW5p\
bwogICAgZnJlZTogdHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJhbWV0ZXJzOgogICAgLSBu\
YW1lOiBwcm9qZWN0X25hbWUKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQcm9qZWN0\
IE5hbWUKICAgICAgZGVmYXVsdDogbWluaW8KICAgICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBw\
cm9wZXJ0aWVzCiAgICAtIG5hbWU6IG1pbmlvX2ltYWdlCiAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICB0aXRsZTogTWluaW8gaW1hZ2UKICAgICAgZGVmYXVsdDogbWluaW8vbWluaW8KICAgICAgZGlz\
cGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVzCiAgICAtIG5hbWU6IG1pbmlvX2ltYWdlX3Zl\
cnNpb24KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBJbWFnZSB2ZXJzaW9uCiAgICAg\
IGRlZmF1bHQ6ICJSRUxFQVNFLjIwMTktMDItMjZUMTktNTEtNDZaIgogICAgICBkaXNwbGF5X2dy\
b3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKICAgIC0gbmFtZTogbWluaW9fbW9kZQogICAgICB0aXRs\
ZTogTW9kZQogICAgICBkZWZhdWx0OiAnU3RhbmRhbG9uZScKICAgICAgdHlwZTogZW51bQogICAg\
ICBlbnVtOiBbJ1N0YW5kYWxvbmUnLCAnRGlzdHJpYnV0ZWQnXQogICAgICBkaXNwbGF5X2dyb3Vw\
OiBQcm9qZWN0IHByb3BlcnRpZXMKICAgIC0gbmFtZTogbWluaW9fbm9kZXMKICAgICAgdHlwZTog\
aW50ZWdlcgogICAgICB0aXRsZTogTnVtYmVyIG9mIG5vZGVzIChtdXN0IGJlIGV2ZW4pCiAgICAg\
IGRlZmF1bHQ6ICc0JwogICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKICAg\
IC0gbmFtZTogbWluaW9fc2l6ZQogICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgIHRpdGxlOiBTdG9y\
YWdlIHNpemUgaW4gR2IKICAgICAgZGVmYXVsdDogJzUnCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFBy\
b2plY3QgcHJvcGVydGllcwogICAgLSBuYW1lOiBtaW5pb19zdG9yYWdlX2NsYXNzCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICB0aXRsZTogU3RvcmFnZSBjbGFzcyAoUldYIGZvciBzdGFuZGFsb25l\
IGFuZCBSV08gZm9yIGRpc3RyaWJ1dGVkKQogICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHBy\
b3BlcnRpZXMKCiAgICAtIG5hbWU6IGltYWdlX3B1bGxQb2xpY3kKICAgICAgZGVmYXVsdDogJ0lm\
Tm90UHJlc2VudCcKICAgICAgdHlwZTogZW51bQogICAgICBlbnVtOiBbJ0lmTm90UHJlc2VudCcs\
ICdBbHdheXMnLCAnTmV2ZXInXQogICAgICB0aXRsZTogSW1hZ2UgcHVsbCBwb2xpY3kKICAgICAg\
ZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCiAgICAtIG5hbWU6IHBvZEFubm90YXRpb25z\
CiAgICAgIGRlZmF1bHQ6ICd7fScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBBbm5v\
dGF0aW9ucyB0byBiZSBhZGRlZCB0byBNaW5pbyBwb2RzCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4\
dGFyZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCiAgICAtIG5hbWU6IHNl\
Y3VyaXR5Q29udGV4dAogICAgICBkZWZhdWx0OiAne30nCiAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICB0aXRsZTogU2VjdXJpdHkgY29udGV4dCBmb3IgdGhlIHBvZAogICAgICBkaXNwbGF5X3R5cGU6\
IHRleHRhcmVhCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBTcGVjcwogICAgLSBuYW1l\
OiByZXNvdXJjZXMKICAgICAgZGVmYXVsdDogJ3sibGltaXRzIjogeyJjcHUiOiAiMSIsIm1lbW9y\
eSI6ICI1MTJNaSJ9LCJyZXF1ZXN0cyI6IHsiY3B1IjogIjAuNSIsIm1lbW9yeSI6ICIyNTZNaSJ9\
fScKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQb2QgcmVzb3VyY2UgcmVxdWVzdHMg\
YW5kIGxpbWl0cwogICAgICBkaXNwbGF5X3R5cGU6IHRleHRhcmVhCiAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IENvbnRhaW5lciBTcGVjcwoK"


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-s3-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb