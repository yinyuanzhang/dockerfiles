FROM alpine:latest

ARG GLIBC_BASE_URL="https://github.com/sgerrand/alpine-pkg-glibc/releases/download"
ARG GLIBC_PACKAGE_VERSION="2.28-r0"
ARG GLIBC_BASE_PACKAGE_FILENAME="glibc-$GLIBC_PACKAGE_VERSION.apk"
ARG GLIBC_BIN_PACKAGE_FILENAME="glibc-bin-$GLIBC_PACKAGE_VERSION.apk"
ARG GLIBC_I18N_PACKAGE_FILENAME="glibc-i18n-$GLIBC_PACKAGE_VERSION.apk"

ADD https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub /etc/apk/keys/sgerrand.rsa.pub
ADD $GLIBC_BASE_URL/$GLIBC_PACKAGE_VERSION/$GLIBC_BASE_PACKAGE_FILENAME $GLIBC_BASE_PACKAGE_FILENAME
ADD $GLIBC_BASE_URL/$GLIBC_PACKAGE_VERSION/$GLIBC_BIN_PACKAGE_FILENAME $GLIBC_BIN_PACKAGE_FILENAME
ADD $GLIBC_BASE_URL/$GLIBC_PACKAGE_VERSION/$GLIBC_I18N_PACKAGE_FILENAME $GLIBC_I18N_PACKAGE_FILENAME

RUN apk add --update --no-cache curl bash libstdc++
RUN apk add $GLIBC_BASE_PACKAGE_FILENAME $GLIBC_BIN_PACKAGE_FILENAME $GLIBC_I18N_PACKAGE_FILENAME \
    && rm "/etc/apk/keys/sgerrand.rsa.pub" $GLIBC_BASE_PACKAGE_FILENAME $GLIBC_BIN_PACKAGE_FILENAME $GLIBC_I18N_PACKAGE_FILENAME
RUN /usr/glibc-compat/bin/localedef -i en_US -f UTF-8 en_US.UTF-8

USER 1001
VOLUME ["/game", "/.config"]
WORKDIR /game
