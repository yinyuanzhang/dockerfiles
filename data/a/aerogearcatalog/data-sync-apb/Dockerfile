FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGRhdGEtc3luYy1hcGIKZGVzY3JpcHRpb246IEluc3RhbGxzIHRo\
ZSBBZXJvZ2VhciBEYXRhIFN5bmMgU2VydmljZQpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9u\
YWwKdGFnczoKICAtIG1vYmlsZS1zZXJ2aWNlCiAgLSBtb2JpbGUtY2xpZW50LWVuYWJsZWQKbWV0\
YWRhdGE6CiAgZGlzcGxheU5hbWU6IERhdGEgU3luYwogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2lj\
b25DbGFzczogZmEgZmEtcmVmcmVzaAogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRwczovL2RvY3Mu\
YWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9kYXRhLXN5bmMuaHRtbCIKICBwcm92aWRlckRpc3Bs\
YXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKICBzZGstZG9jcy1hbmRyb2lkOiAiaHR0cHM6Ly9kb2Nz\
LmFlcm9nZWFyLm9yZy9leHRlcm5hbC9hcGIvc3luYy9hbmRyb2lkLmh0bWwiCiAgIyBzZGstZG9j\
cy1jb3Jkb3ZhOiAiaHR0cHM6Ly9kb2NzLmFlcm9nZWFyLm9yZy9leHRlcm5hbC9hcGIvbWV0cmlj\
cy9jb3Jkb3ZhLmh0bWwiCiAgc2RrLWRvY3MtaW9zOiAiaHR0cHM6Ly9kb2NzLmFlcm9nZWFyLm9y\
Zy9leHRlcm5hbC9hcGIvc3luYy9pb3MuaHRtbCIKICAjIHNkay1kb2NzLXhhbWFyaW46ICJodHRw\
czovL2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9tZXRyaWNzL3hhbWFyaW4uaHRtbCIK\
ICBzZXJ2aWNlTmFtZTogZGF0YS1zeW5jCiAgZGVwZW5kZW5jaWVzOgogICAgLSAiZG9ja2VyLmlv\
L2Flcm9nZWFyL2RhdGEtc3luYy11aSIKICAgIC0gImRvY2tlci5pby9hZXJvZ2Vhci9kYXRhLXN5\
bmMtc2VydmVyIgogICAgLSAiZG9ja2VyLmlvL29wZW5zaGlmdC9vYXV0aC1wcm94eTp2MS4xLjAi\
CiAgICAtICJkb2NrZXIuaW8vY2VudG9zL3Bvc3RncmVzcWwtOTYtY2VudG9zNzo5LjYiCnBsYW5z\
OgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IFRoaXMgcGxhbiBzZXRzIHVwIHRo\
ZSBEYXRhIFN5bmMgQWRtaW4gVUksIFRoZSBEYXRhIFN5bmMgU2VydmVyIGFuZCBQb3N0Z3JlU1FM\
CiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgbW9iaWxlY2xpZW50X2JpbmRfcGFy\
YW1ldGVyc19kYXRhOgogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfSUQiLCAidmFsdWUiOiAi\
bWV0YWRhdGEubmFtZSIsICJ0eXBlIjogInBhdGgifScKICAgIHBhcmFtZXRlcnM6IAogICAgICAt\
IG5hbWU6IFBPU1RHUkVTX1NUT1JBR0VfU0laRQogICAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAg\
ICAgZGVmYXVsdDogMTAKICAgICAgICB0eXBlOiBudW1iZXIKICAgICAgICB0aXRsZTogUG9zdGdy\
ZXMgU3RvcmFnZSBTaXplIChHYikKICAgICAgLSBuYW1lOiBQT1NUR1JFU19VU0VSCiAgICAgICAg\
ZGVzY3JpcHRpb246IFVzZXJuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGNvbm5lY3QgdG8gcG9z\
dGdyZXMgKCd1c2VyJyB3aWxsIGJlIHVzZWQgaWYgYmxhbmspCiAgICAgICAgZGVmYXVsdDogdXNl\
cgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICAgIHRp\
dGxlOiBQb3N0Z3JlcyBVc2VyCiAgICAgIC0gbmFtZTogUE9TVEdSRVNfUEFTU1dPUkQKICAgICAg\
ICBkZXNjcmlwdGlvbjogUGFzc3dvcmQgdG8gY29ubmVjdCB0byBQb3N0Z3JlcyAoZ2VuZXJhdGVk\
IGlmIGJsYW5rKQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBGYWxzZQog\
ICAgICAgIHRpdGxlOiBQb3N0Z3JlcyBQYXNzd29yZAogICAgICAtIG5hbWU6IFFVRVJZX0RFUFRI\
X0xJTUlUCiAgICAgICAgZGVzY3JpcHRpb246IExpbWl0IHRoZSBjb21wbGV4aXR5IG9mIHRoZSBx\
dWVyaWVzIHNvbGVseSBieSB0aGVpciBkZXB0aC4KICAgICAgICB0eXBlOiBudW1iZXIKICAgICAg\
ICByZXF1aXJlZDogRmFsc2UKICAgICAgICB0aXRsZTogUXVlcnkgZGVwdGggbGltaXQKICAgICAg\
ICBkZWZhdWx0OiAyMAogICAgICAtIG5hbWU6IENPTVBMRVhJVFlfTElNSVQKICAgICAgICBkZXNj\
cmlwdGlvbjogTGltaXQgdGhlIGNvbXBsZXhpdHkgb2YgdGhlIHF1ZXJpZXMgYmFzZWQgb24gdGhl\
IGRhdGEuCiAgICAgICAgdHlwZTogbnVtYmVyCiAgICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAg\
ICAgdGl0bGU6IFF1ZXJ5IGNvbXBsZXhpdHkgbGltaXQKICAgICAgICBkZWZhdWx0OiAxMDAwMAog\
ICAgYmluZF9wYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IENMSUVOVF9JRAogICAgICAgIHJlcXVp\
cmVkOiBUcnVlCiAgICAgICAgdGl0bGU6IE1vYmlsZSBDbGllbnQgSUQKICAgICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgICAK"










COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
