#
# NOTE: THIS DOCKERFILE IS GENERATED VIA "update.sh"
#
# PLEASE DO NOT EDIT IT DIRECTLY.
#
FROM php:7.2-cli-alpine3.9 as php

RUN set -eux \
  && apk upgrade --no-cache \
  && apk add --no-cache \
    $PHPIZE_DEPS

COPY docker-php* /usr/local/bin/

RUN set -eux \
##<autogenerated>##
&& docker-php-ext-install-pcntl \
##</autogenerated>##
  && docker-php-ext-install-apcu \
  && docker-php-ext-install-bcmath \
  && docker-php-ext-install-gd \
  && docker-php-ext-install-iconv \
  && docker-php-ext-install-imagick \
  && docker-php-ext-install-intl \
  && docker-php-ext-install-memcached \
  && docker-php-ext-install-mysql \
  && docker-php-ext-install-opcache \
  && docker-php-ext-install-pgsql \
  && docker-php-ext-install-phalcon \
  && docker-php-ext-install-redis \
  && docker-php-ext-install-sockets \
  && docker-php-ext-install-sodium \
  && docker-php-ext-install-xdebug \
  && docker-php-ext-install-xhprof \
  && docker-php-ext-install-xsl \
  && docker-php-ext-install-zip

##<autogenerated>##
# add additional FROM steps
##</autogenerated>##

FROM alpine:3.9

# redefine phpize dependencies
ENV PHPIZE_DEPS \
  autoconf \
  dpkg-dev dpkg \
  file \
  g++ \
  gcc \
  libc-dev \
  make \
  pkgconf \
  re2c

# copy dependencies from php
COPY --from=php /usr/local/bin /usr/local/bin
COPY --from=php /usr/local/etc/php/conf.d/ /usr/local/etc/php/conf.d/
COPY --from=php /usr/local/include/php /usr/local/include/php
COPY --from=php /usr/local/lib/php/extensions /usr/local/lib/php/extensions
COPY --from=php /usr/local/php /usr/local/php
COPY --from=php /usr/src /usr/src

##<autogenerated>##
# add additional copy commands
##</autogenerated>##

COPY docker-install* /usr/local/bin/
COPY ssh_config /root/.ssh/config

# install dev deps
RUN set -eux \
  && apk upgrade --no-cache \
  && apk add --no-cache \
    binutils \
    git \
    openssh \
    shadow \
    nano \
    bash \
    curl \
# find required deps for php
  && PHP_RUN_DEPS="$( \
    scanelf --needed --nobanner --format '%n#p' /usr/local/bin/php /usr/local/lib/php/extensions/*/*.so \
        | tr ',' '\n' \
        | sort -u \
        | awk 'system("[ -e /usr/local/lib/" $1 " ]") == 0 { next } { print "so:" $1 }' \
    )" \
  && apk add --no-cache \
    $PHP_RUN_DEPS \
  && docker-install-box \
  && docker-install-composer \
  && docker-install-phpunit \
  && docker-install-php-cs-fixer \
  && docker-install-phpstan \
  && docker-install-ppm \
##<autogenerated>##
# add additional dependencies
# simple functionality check
  && php -v \
  && box --version \
  && composer --version \
  && phpunit --version \
  && php-cs-fixer --version \
  && phpstan --version \
  && ppm --version

WORKDIR /var/www

ENTRYPOINT ["docker-php-entrypoint"]

CMD ["php", "-a"]
##</autogenerated>##
